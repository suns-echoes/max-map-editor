var palette = [
	0x00, 0x00, 0x00, // #000000
	0xff, 0x00, 0x00, // #ff0000
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xff, 0xff, 0x00, // #ffff00
	0xff, 0xab, 0x00, // #ffab00
	0x83, 0x83, 0xa3, // #8383a3
	0xff, 0x47, 0x00, // #ff4700
	0xff, 0xff, 0x93, // #ffff93
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0xd7, 0x07, 0xff, // #d707ff
	0x83, 0xbb, 0x1b, // #83bb1b
	0x6f, 0xab, 0x0f, // #6fab0f
	0x5f, 0x9f, 0x0b, // #5f9f0b
	0x4f, 0x93, 0x07, // #4f9307
	0x43, 0x77, 0x07, // #437707
	0x33, 0x5f, 0x07, // #335f07
	0x27, 0x43, 0x07, // #274307
	0x1b, 0x2b, 0x07, // #1b2b07
	0xbb, 0xbb, 0x07, // #bbbb07
	0xb3, 0x87, 0x07, // #b38707
	0xab, 0x57, 0x07, // #ab5707
	0xa3, 0x2f, 0x07, // #a32f07
	0x00, 0x00, 0x00, // #000000
	0x67, 0x07, 0x7b, // #67077b
	0x7b, 0x37, 0x07, // #7b3707
	0x93, 0xbb, 0x0f, // #93bb0f
	0x6b, 0x9f, 0xbb, // #6b9fbb
	0x47, 0x87, 0xab, // #4787ab
	0x2f, 0x73, 0x97, // #2f7397
	0x17, 0x63, 0x87, // #176387
	0x0f, 0x4f, 0x6f, // #0f4f6f
	0x0b, 0x3b, 0x57, // #0b3b57
	0x07, 0x2b, 0x43, // #072b43
	0x07, 0x1b, 0x2b, // #071b2b
	0xbb, 0x7b, 0x57, // #bb7b57
	0xaf, 0x63, 0x37, // #af6337
	0xa3, 0x4f, 0x1b, // #a34f1b
	0x97, 0x3b, 0x07, // #973b07
	0x7b, 0x2f, 0x07, // #7b2f07
	0x63, 0x27, 0x07, // #632707
	0x47, 0x1b, 0x07, // #471b07
	0x27, 0x0f, 0x07, // #270f07
	0xc7, 0xe3, 0xff, // #c7e3ff
	0xbf, 0xdf, 0xf7, // #bfdff7
	0xbf, 0xd7, 0xf7, // #bfd7f7
	0xb3, 0xdb, 0xfb, // #b3dbfb
	0xbf, 0xd7, 0xef, // #bfd7ef
	0xb7, 0xd7, 0xef, // #b7d7ef
	0xb7, 0xd7, 0xe7, // #b7d7e7
	0xbb, 0xd3, 0xdf, // #bbd3df
	0xab, 0xd7, 0xef, // #abd7ef
	0xb7, 0xcf, 0xef, // #b7cfef
	0xb7, 0xcf, 0xe7, // #b7cfe7
	0xaf, 0xcf, 0xe7, // #afcfe7
	0xab, 0xcf, 0xef, // #abcfef
	0xa7, 0xcf, 0xe7, // #a7cfe7
	0xb7, 0xc7, 0xdf, // #b7c7df
	0xaf, 0xc7, 0xe7, // #afc7e7
	0xaf, 0xc7, 0xdf, // #afc7df
	0xa7, 0xc7, 0xdf, // #a7c7df
	0xaf, 0xbf, 0xd7, // #afbfd7
	0xa7, 0xbf, 0xdf, // #a7bfdf
	0xa7, 0xbf, 0xd7, // #a7bfd7
	0xab, 0xbb, 0xc7, // #abbbc7
	0x9f, 0xbf, 0xcf, // #9fbfcf
	0x9f, 0xb7, 0xcf, // #9fb7cf
	0x9b, 0xb7, 0xc7, // #9bb7c7
	0x9f, 0xaf, 0xc7, // #9fafc7
	0x97, 0xaf, 0xc7, // #97afc7
	0x97, 0xaf, 0xbf, // #97afbf
	0x97, 0xa7, 0xbf, // #97a7bf
	0x9b, 0xa7, 0xa7, // #9ba7a7
	0x8f, 0xa7, 0xbf, // #8fa7bf
	0x8f, 0x9f, 0xb7, // #8f9fb7

	0x4f, 0x7f, 0xa3, // #4f7fa3
	0x4f, 0x7f, 0x9f, // #4f7f9f
	0x4f, 0x7f, 0xa3, // #4f7fa3
	0x53, 0x83, 0xa7, // #5383a7
	0x57, 0x87, 0xab, // #5787ab
	0x5b, 0x8b, 0xaf, // #5b8baf
	0x53, 0x83, 0xa7, // #5383a7

	0x4f, 0x77, 0x9b, // #4f779b
	0x4f, 0x7b, 0x9f, // #4f7b9f
	0x53, 0x7f, 0xa3, // #537fa3
	0x53, 0x83, 0xa7, // #5383a7
	0x57, 0x87, 0xab, // #5787ab
	0x5b, 0x8b, 0xaf, // #5b8baf
	0x53, 0x83, 0xa7, // #5383a7

	0x47, 0x73, 0x8f, // #47738f
	0x43, 0x6b, 0x87, // #436b87
	0x47, 0x73, 0x8f, // #47738f
	0x4f, 0x7b, 0x9b, // #4f7b9b
	0x53, 0x83, 0xa3, // #5383a3
	0x5b, 0x8b, 0xaf, // #5b8baf
	0x4f, 0x7b, 0x9b, // #4f7b9b
	0x4b, 0x37, 0x2b, // #4b372b
	0x5f, 0x5f, 0x37, // #5f5f37
	0x5b, 0x8b, 0xaf, // #5b8baf
	0x63, 0x7f, 0x73, // #637f73
	0x57, 0x63, 0x3b, // #57633b
	0x4b, 0x37, 0x2b, // #4b372b
	0x7b, 0x97, 0xab, // #7b97ab
	0x67, 0x87, 0x9f, // #67879f
	0x53, 0x77, 0x93, // #537793
	0x57, 0x83, 0x9f, // #57839f
	0x63, 0x8b, 0xa3, // #638ba3
	0xb3, 0xc3, 0xcb, // #b3c3cb
	0x9f, 0x9f, 0x93, // #9f9f93
	0x87, 0x9f, 0xaf, // #879faf
	0x9f, 0x97, 0x8b, // #9f978b
	0x8f, 0x97, 0xa3, // #8f97a3
	0x7b, 0x97, 0xa7, // #7b97a7
	0x8f, 0x87, 0x7b, // #8f877b
	0x73, 0x87, 0x93, // #738793
	0x6b, 0x7b, 0x97, // #6b7b97
	0x63, 0x7f, 0x8b, // #637f8b
	0x8b, 0x73, 0x4b, // #8b734b
	0x63, 0x73, 0x87, // #637387
	0x67, 0x6f, 0x73, // #676f73
	0x77, 0x6b, 0x5b, // #776b5b
	0x5b, 0x6f, 0x7b, // #5b6f7b
	0x53, 0x63, 0x6f, // #53636f
	0x7b, 0x57, 0x2f, // #7b572f
	0x5b, 0x5b, 0x57, // #5b5b57
	0x4b, 0x5b, 0x67, // #4b5b67
	0x17, 0x63, 0x87, // #176387
	0x63, 0x47, 0x2b, // #63472b
	0x4f, 0x4b, 0x47, // #4f4b47
	0x47, 0x4b, 0x4b, // #474b4b
	0x6b, 0x37, 0x0b, // #6b370b
	0x37, 0x3f, 0x4b, // #373f4b
	0x0f, 0x4f, 0x6b, // #0f4f6b
	0x4b, 0x3b, 0x27, // #4b3b27
	0x4f, 0x2b, 0x0b, // #4f2b0b
	0x2f, 0x27, 0x23, // #2f2723
	0x37, 0x1f, 0x0b, // #371f0b
	0x27, 0x17, 0x07, // #271707
	0x17, 0x0f, 0x00, // #170f00
	0xff, 0xfb, 0xf7, // #fffbf7
	0xf3, 0xdf, 0xd3, // #f3dfd3
	0xf3, 0xdb, 0xbb, // #f3dbbb
	0xdf, 0xc7, 0xaf, // #dfc7af
	0xdf, 0xc3, 0x9b, // #dfc39b
	0xdb, 0xb7, 0x8f, // #dbb78f
	0xc7, 0xa7, 0x7f, // #c7a77f
	0xb7, 0xa3, 0x83, // #b7a383
	0xab, 0x9b, 0x7b, // #ab9b7b
	0x9f, 0x97, 0x8b, // #9f978b
	0xaf, 0xa7, 0x93, // #afa793
	0xbf, 0xab, 0x97, // #bfab97
	0xc7, 0xbb, 0xaf, // #c7bbaf
	0xcf, 0xa3, 0x6b, // #cfa36b
	0xbf, 0x9b, 0x67, // #bf9b67
	0xab, 0x8b, 0x5f, // #ab8b5f
	0xa3, 0x8b, 0x6b, // #a38b6b
	0x9b, 0x87, 0x63, // #9b8763
	0x93, 0x87, 0x73, // #938773
	0x83, 0x7f, 0x77, // #837f77
	0x7b, 0x73, 0x67, // #7b7367
	0x83, 0x73, 0x5b, // #83735b
	0x8b, 0x7b, 0x63, // #8b7b63
	0x93, 0x77, 0x53, // #937753
	0x9f, 0x7f, 0x4b, // #9f7f4b
	0xab, 0x83, 0x4b, // #ab834b
	0xb3, 0x8b, 0x53, // #b38b53
	0xc3, 0x93, 0x53, // #c39353
	0xc7, 0x8b, 0x43, // #c78b43
	0xb3, 0x7f, 0x3b, // #b37f3b
	0xa7, 0x73, 0x37, // #a77337
	0x93, 0x6f, 0x3b, // #936f3b
	0x83, 0x6b, 0x3b, // #836b3b
	0x7b, 0x63, 0x47, // #7b6347
	0x73, 0x63, 0x3b, // #73633b
	0x73, 0x57, 0x2b, // #73572b
	0x67, 0x53, 0x2f, // #67532f
	0x5b, 0x4f, 0x3b, // #5b4f3b
	0x53, 0x47, 0x33, // #534733
	0x53, 0x3f, 0x2b, // #533f2b
	0x4b, 0x3b, 0x27, // #4b3b27
	0x43, 0x3b, 0x2b, // #433b2b
	0x3b, 0x33, 0x27, // #3b3327
	0x33, 0x2b, 0x1f, // #332b1f
	0x2b, 0x27, 0x23, // #2b2723
	0x27, 0x23, 0x1f, // #27231f
	0x1f, 0x1b, 0x17, // #1f1b17
	0x0f, 0x0f, 0x0f, // #0f0f0f
	0x37, 0x1f, 0x1f, // #371f1f
	0x2f, 0x2b, 0x2b, // #2f2b2b
	0x37, 0x33, 0x33, // #373333
	0x3f, 0x3b, 0x3b, // #3f3b3b
	0x4b, 0x47, 0x47, // #4b4747
	0x57, 0x53, 0x53, // #575353
	0x5f, 0x5b, 0x5b, // #5f5b5b
	0x67, 0x63, 0x63, // #676363
	0x6f, 0x6b, 0x6b, // #6f6b6b
	0x73, 0x67, 0x53, // #736753
	0x6b, 0x5f, 0x4b, // #6b5f4b
	0x63, 0x57, 0x43, // #635743
	0x57, 0x43, 0x23, // #574323
	0x4b, 0x2b, 0x2b, // #4b2b2b
	0x2f, 0x2b, 0x3b, // #2f2b3b
	0x83, 0x63, 0x2b, // #83632b
	0x83, 0x6b, 0x4b, // #836b4b
	0xcf, 0x83, 0x6b, // #cf836b
	0xab, 0x6f, 0x5b, // #ab6f5b
	0xbb, 0x53, 0x37, // #bb5337
	0x7b, 0x4f, 0x43, // #7b4f43
	0x9b, 0x3f, 0x2f, // #9b3f2f
	0x73, 0x27, 0x23, // #732723
	0x4b, 0x1f, 0x17, // #4b1f17
	0x1f, 0x0f, 0x0f, // #1f0f0f
	0x8b, 0xab, 0x63, // #8bab63
	0x73, 0x93, 0x4f, // #73934f
	0x57, 0x93, 0x3b, // #57933b
	0x5f, 0x73, 0x43, // #5f7343
	0x43, 0x6b, 0x2f, // #436b2f
	0x3b, 0x53, 0x23, // #3b5323
	0x2b, 0x43, 0x1b, // #2b431b
	0x17, 0x1b, 0x0f, // #171b0f
	0x77, 0x6f, 0x9f, // #776f9f
	0x63, 0x57, 0x83, // #635783
	0x3b, 0x43, 0x8b, // #3b438b
	0x43, 0x43, 0x6b, // #43436b
	0x2f, 0x33, 0x6b, // #2f336b
	0x43, 0x3b, 0x4f, // #433b4f
	0x1f, 0x23, 0x4b, // #1f234b
	0x0f, 0x13, 0x2b, // #0f132b
	0xb7, 0x67, 0x00, // #b76700
	0x87, 0x4b, 0x00, // #874b00
	0x5b, 0x33, 0x00, // #5b3300
	0x9b, 0x9b, 0x00, // #9b9b00
	0x6f, 0x6f, 0x00, // #6f6f00
	0x43, 0x43, 0x00, // #434300
	0xff, 0xff, 0xff, // #ffffff
];

palette.getColor = getColor.bind(palette);

var water1SubPaletteStart = 96;
var water1SubPaletteEnd = 102;
var water2SubPaletteStart = 103;
var water2SubPaletteEnd = 109;

let errorCountLimit = 10;

function getColor(index) {
	if (index < 0 || index >= this.length / 3) {
		if (errorCountLimit > 0) {
			console.error("Index out of bounds for palette", index, this.length / 3);
			errorCountLimit--;
		}
		return {
			r: 255,
			g: 0,
			b: 255,
			a: 255,
		};
		// throw new Error("Index out of bounds for palette", index, this.length / 3);
	}
	return {
		r: this[index * 3],
		g: this[index * 3 + 1],
		b: this[index * 3 + 2],
		a: 255,
	};
}

var createSubPalette = function(start, end, sourcePalette = palette) {
	var subPalette = [];
	for (var i = start; i <= end; i++) {
		if (i * 3 + 2 < sourcePalette.length) {
			subPalette.push(sourcePalette[i * 3]);
			subPalette.push(sourcePalette[i * 3 + 1]);
			subPalette.push(sourcePalette[i * 3 + 2]);
		} else {
			subPalette.push(0, 0, 0);
		}
	}
	subPalette.getColor = getColor.bind(subPalette);
	return subPalette;
}

var water1Palette = createSubPalette(water1SubPaletteStart, water1SubPaletteEnd);
var water2Palette = createSubPalette(water2SubPaletteStart, water2SubPaletteEnd);
var waterPalette = createSubPalette(water1SubPaletteStart, water2SubPaletteEnd);

var water1AltPalette = createSubPalette(0, 7, [
	0x00, 0x30, 0x00,
	0x00, 0x50, 0x00,
	0x00, 0x70, 0x00,
	0x00, 0x90, 0x00,
	0x00, 0xb0, 0x00,
	0x00, 0xd0, 0x00,
	0x00, 0xf0, 0x00,
]);
var water2AltPalette = createSubPalette(0, 7, [
	0x30, 0x00, 0x00,
	0x50, 0x00, 0x00,
	0x70, 0x00, 0x00,
	0x90, 0x00, 0x00,
	0xb0, 0x00, 0x00,
	0xd0, 0x00, 0x00,
	0xf0, 0x00, 0x00,
]);

var blackPalette = createSubPalette(0, 7, [
	0x30, 0x00, 0x00, 0x00,
	0x50, 0x00, 0x00, 0x00,
	0x70, 0x00, 0x00, 0x00,
	0x90, 0x00, 0x00, 0x00,
	0xb0, 0x00, 0x00, 0x00,
	0xd0, 0x00, 0x00, 0x00,
	0xf0, 0x00, 0x00, 0x00,
]);
